<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE"/>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>Teamwork</title>
  <link rel=stylesheet href="platform.css" type="text/css">
  <link rel=stylesheet href="libs/dateField/jquery.dateField.css" type="text/css">
  <link rel=stylesheet href="gantt.css" type="text/css">
  <link rel=stylesheet href="print.css" type="text/css" media="print">
  <script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
  <script src="http://libs.baidu.com/jqueryui/1.8.22/jquery-ui.min.js "></script>
  <script src="libs/jquery.livequery.min.js"></script>
  <script src="libs/jquery.timers.js"></script>
  <script src="libs/platform.js"></script>
  <script src="libs/date.js"></script>
  <script src="libs/i18nJs.js"></script>
  <script src="libs/dateField/jquery.dateField.js"></script>
  <script src="libs/JST/jquery.JST.js"></script>

  <link rel="stylesheet" type="text/css" href="libs/jquery.svg.css">
  <script type="text/javascript" src="libs/jquery.svg.min.js"></script>

  <!--In case of jquery 1.8-->
  <script src="ganttArr.js"></script>
  <script type="text/javascript" src="libs/jquery.svgdom.1.8.js"></script>
  <script src="ganttUtilities.js"></script>
  <script src="ganttTask.js"></script>
  <script src="ganttDrawerSVG.js"></script>
  <script src="ganttGridEditor.js"></script>
  <script src="ganttMaster.js"></script>

</head>
<body style="background-color: #fff;">

<div id="workSpace" style="padding:0px; overflow-y:auto; overflow-x:hidden;border:1px solid #e5e5e5;position:relative;margin:0 5px"></div>

<div id="taZone" style="display:none;" class="noprint">
   <textarea rows="8" cols="150" id="ta">

   </textarea>
</div>


<div id="gantEditorTemplates" style="display:none;">
  <div class="__template__" type="GANTBUTTONS"><!--
  <div class="ganttButtonBar noprint">
    <h1 style="float:left">task tree/gantt</h1>
    <div class="buttons">
    <button onclick="$('#workSpace').trigger('undo.gantt');" class="button textual" title="撤消"><span class="teamworkIcon">&#39;</span></button>
    <button onclick="$('#workSpace').trigger('redo.gantt');" class="button textual" title="重做"><span class="teamworkIcon">&middot;</span></button>
    <span class="ganttButtonSeparator"></span>
    <button onclick="$('#workSpace').trigger('addAboveCurrentTask.gantt');" class="button textual" title="在上方插入行"><span class="teamworkIcon">l</span></button>
    <button onclick="$('#workSpace').trigger('addBelowCurrentTask.gantt');" class="button textual" title="在下方插入行"><span class="teamworkIcon">X</span></button>
    <span class="ganttButtonSeparator"></span>
    <button onclick="$('#workSpace').trigger('indentCurrentTask.gantt');" class="button textual" title="缩进"><span class="teamworkIcon">.</span></button>
    <button onclick="$('#workSpace').trigger('outdentCurrentTask.gantt');" class="button textual" title="取消缩进"><span class="teamworkIcon">:</span></button>
    <span class="ganttButtonSeparator"></span>
    <button onclick="$('#workSpace').trigger('moveUpCurrentTask.gantt');" class="button textual" title="升级"><span class="teamworkIcon">k</span></button>
    <button onclick="$('#workSpace').trigger('moveDownCurrentTask.gantt');" class="button textual" title="降升"><span class="teamworkIcon">j</span></button>
    <span class="ganttButtonSeparator"></span>
    <button onclick="$('#workSpace').trigger('deleteCurrentTask.gantt');" class="button textual" title="删除"><span class="teamworkIcon">&cent;</span></button>
    </div></div>
  --></div>

    <div class="__template__" type="TASKSEDITHEAD"><!--
  <table class="gdfTable" cellspacing="0" cellpadding="0">
    <thead>
    <tr style="height:40px">
      <th class="gdfColHeader gdfResizable" style="width:200px;">任务名称</th>
      <th class="gdfColHeader gdfResizable" style="width:70px;">子项目</th>
      <th class="gdfColHeader gdfResizable" style="width:100px;">参与人</th>
      <th class="gdfColHeader gdfResizable" style="width:70px;">类型</th>
      <th class="gdfColHeader gdfResizable" style="width:0px;">部门</th>

    </tr>
    </thead>
  </table>
  --></div>

    <div class="__template__" type="TASKROW"><!--
  <tr taskId="(#=obj.id#)" class="taskEditRow" level="(#=level#)">
    <td class="gdfCell indentCell" style="padding-left:(#=obj.level*10#)px;">
      <div class="(#=obj.isParent()?'exp-controller expcoll exp':'exp-controller'#)" align="center"></div>
      <input type="text" name="name" value="(#=obj.name#)">
    </td>
    <td class="gdfCell"><input type="text" name="code" value="(#=obj.code?obj.code:''#)"></td>
    <td class="gdfCell gdfper"><input type="text" ></td>
    <td class="gdfCell"><input type="text"></td>
    <td class="gdfCell"><input type="text" name="depends" value="(#=obj.depends#)" (#=obj.hasExternalDep?"readonly":""#)></td>

  </tr>
  --></div>

  <div class="__template__" type="TASKEMPTYROW"><!--
  <tr class="taskEditRow emptyRow" >
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
    <td class="gdfCell"></td>
  </tr>
  --></div>

  <div class="__template__" type="TASKBAR"><!--
  <div class="taskBox taskBoxDiv" taskId="(#=obj.id#)" >
    <div class="layout (#=obj.hasExternalDep?'extDep':''#)">
      <div class="taskStatus" status="(#=obj.status#)"></div>
      <div class="taskProgress" style="width:(#=obj.progress>100?100:obj.progress#)%; background-color:(#=obj.progress>100?'red':'rgb(153,255,51);'#);"></div>
      <div class="milestone (#=obj.startIsMilestone?'active':''#)" ></div>

      <div class="taskLabel"></div>
      <div class="milestone end (#=obj.endIsMilestone?'active':''#)" ></div>
    </div>
  </div>
  --></div>

  <div class="__template__" type="CHANGE_STATUS">
    <div class="taskStatusBox">
      <div class="taskStatus cvcColorSquare" status="STATUS_ACTIVE" title="active"></div>
      <div class="taskStatus cvcColorSquare" status="STATUS_DONE" title="completed"></div>
      <div class="taskStatus cvcColorSquare" status="STATUS_SUSPENDED" title="suspended"></div>
      <div class="taskStatus cvcColorSquare" status="STATUS_FAILED" title="failed"></div>
    </div>
    <!--<div class="taskStatusBox">
      <div class="taskStatus cvcColorSquare" status="STATUS_ACTIVE" title="active"></div>
      <div class="taskStatus cvcColorSquare" status="STATUS_DONE" title="completed"></div>
      <div class="taskStatus cvcColorSquare" status="STATUS_FAILED" title="failed"></div>
      <div class="taskStatus cvcColorSquare" status="STATUS_SUSPENDED" title="suspended"></div>
      <div class="taskStatus cvcColorSquare" status="STATUS_UNDEFINED" title="undefined"></div>
    </div>-->
 </div>


  <div class="__template__" type="ASSIGNMENT_ROW"><!--
  <tr taskId="(#=obj.task.id#)" assigId="(#=obj.assig.id#)" class="assigEditRow" >
    <td ><select name="resourceId"  class="formElements" (#=obj.assig.id.indexOf("tmp_")==0?"":"disabled"#) ></select></td>
    <td ><select type="select" name="roleId"  class="formElements"></select></td>
    <td ><input type="text" name="effort" value="(#=getMillisInHoursMinutes(obj.assig.effort)#)" size="5" class="formElements"></td>
    <td align="center"><span class="teamworkIcon delAssig" style="cursor: pointer">d</span></td>
  </tr>
  --></div>


  <div class="__template__" type="RESOURCE_EDITOR"><!--
  <div class="resourceEditor" style="padding: 5px;">

    <h2>Project team</h2>
    <table  cellspacing="1" cellpadding="0" width="100%" id="resourcesTable">
      <tr>
        <th style="width:100px;">name</th>
        <th style="width:30px;" id="addResource"><span class="teamworkIcon" style="cursor: pointer">+</span></th>
      </tr>
    </table>

    <div style="text-align: right; padding-top: 20px"><button id="resSaveButton" class="button big">save</button></div>
  </div>
  --></div>


  <div class="__template__" type="RESOURCE_ROW"><!--
  <tr resId="(#=obj.id#)" class="resRow" >
    <td ><input type="text" name="name" value="(#=obj.name#)" style="width:100%;" class="formElements"></td>
    <td align="center"><span class="teamworkIcon delRes" style="cursor: pointer">d</span></td>
  </tr>
  --></div>


</div>
<script type="text/javascript">
  var ge;  //this is the hugly but very friendly global var for the gantt editor
  $(function() {

    //load templates
    $("#ganttemplates").loadTemplates();

    // here starts gantt initialization
    ge = new GanttMaster();
    var workSpace = $("#workSpace");
    workSpace.css({width:$(window).width() - 20,height:$(window).height() - 55});
    ge.init(workSpace);


    $(".ganttButtonBar h1").html("");
    $(".ganttButtonBar div").addClass('buttons');
    loadI18n();
//  loadGanttFromServer();

    //fill default Teamwork roles if any
    if (!ge.roles || ge.roles.length == 0) {
      setRoles();
    }

    //fill default Resources roles if any
    if (!ge.resources || ge.resources.length == 0) {
      setResource();
    }

    $(window).resize(function(){
      workSpace.css({width:$(window).width() - 20,height:$(window).height()-55});
      workSpace.trigger("resize.gantt");
    })

  });

  //-------------------------------------------  Create some demo data ------------------------------------------------------
  function setRoles() {
    ge.roles = [
      {
        id:"tmp_1",
        name:"Project Manager"
      },
      {
        id:"tmp_2",
        name:"Worker"
      },
      {
        id:"tmp_3",
        name:"Stakeholder/Customer"
      }
    ];
  }

  function setResource() {
    var res = [];
    for (var i = 1; i <= 10; i++) {
      res.push({id:"tmp_" + i,name:"Resource " + i});
    }
    ge.resources = res;
  }

  function loadI18n() {
    GanttMaster.messages = {
    };
  }

  //-------------------------------------------  Get project file as JSON (used for migrate project from gantt to Teamwork) ------------------------------------------------------
  function getFile() {
    $("#gimBaPrj").val(JSON.stringify(ge.saveProject()));
    $("#gimmeBack").submit();
    $("#gimBaPrj").val("");

      /*  var uriContent = "data:text/html;charset=utf-8," + encodeURIComponent(JSON.stringify(prj));
       neww=window.open(uriContent,"dl");*/
  }

  //-------------------------------------------  LOCAL STORAGE MANAGEMENT (for this demo only) ------------------------------------------------------
  Storage.prototype.setObject = function(key, value) {
    this.setItem(key, JSON.stringify(value));
  };


  Storage.prototype.getObject = function(key) {
    return this.getItem(key) && JSON.parse(this.getItem(key));
  };


  function loadFromLocalStorage() {
    var ret;
    if (localStorage) {
      if (localStorage.getObject("teamworkGantDemo")) {
        ret = localStorage.getObject("teamworkGantDemo");
      }
    } else {
      $("#taZone").show();
    }
    if (!ret || !ret.tasks || ret.tasks.length == 0){

      ret = JSON.parse($("#ta").val());


      //actualiza data
      var offset=new Date().getTime()-ret.tasks[0].start;
      for (var i=0;i<ret.tasks.length;i++)
        ret.tasks[i].start=ret.tasks[i].start+offset;


    }
    ge.loadProject(ret);
    ge.checkpoint(); //empty the undo stack
  }


  function saveInLocalStorage() {
    var prj = ge.saveProject();
    if (localStorage) {
      localStorage.setObject("teamworkGantDemo", prj);
    } else {
      $("#ta").val(JSON.stringify(prj));
    }
  }

  //-------------------------------------------  Open a black popup for managing resources. This is only an axample of implementation (usually resources come from server) ------------------------------------------------------

  function editResources(){

    //make resource editor
    var resourceEditor = $.JST.createFromTemplate({}, "RESOURCE_EDITOR");
    var resTbl=resourceEditor.find("#resourcesTable");

    for (var i=0;i<ge.resources.length;i++){
      var res=ge.resources[i];
      resTbl.append($.JST.createFromTemplate(res, "RESOURCE_ROW"))
    }


    //bind add resource
    resourceEditor.find("#addResource").click(function(){
      resTbl.append($.JST.createFromTemplate({id:"new",name:"resource"}, "RESOURCE_ROW"))
    });

    //bind save event
    resourceEditor.find("#resSaveButton").click(function(){
      var newRes=[];
      //find for deleted res
      for (var i=0;i<ge.resources.length;i++){
        var res=ge.resources[i];
        var row = resourceEditor.find("[resId="+res.id+"]");
        if (row.size()>0){
          //if still there save it
          var name = row.find("input[name]").val();
          if (name && name!="")
            res.name=name;
          newRes.push(res);
        } else {
          //remove assignments
          for (var j=0;j<ge.tasks.length;j++){
            var task=ge.tasks[j];
            var newAss=[];
            for (var k=0;k<task.assigs.length;k++){
              var ass=task.assigs[k];
              if (ass.resourceId!=res.id)
                newAss.push(ass);
            }
            task.assigs=newAss;
          }
        }
      }

      //loop on new rows
      resourceEditor.find("[resId=new]").each(function(){
        var row = $(this);
        var name = row.find("input[name]").val();
        if (name && name!="")
          newRes.push (new Resource("tmp_"+new Date().getTime(),name));
      });

      ge.resources=newRes;

      closeBlackPopup();
      ge.redraw();
    });


    var ndo = createBlackPage(400, 500).append(resourceEditor);
  }

  function loadGanttFromServer(taskId, callback) {
    loadFromLocalStorage();
  }

$.JST.loadDecorator("ASSIGNMENT_ROW", function(assigTr, taskAssig) {
  var resEl = assigTr.find("[name=resourceId]");
  for (var i in taskAssig.task.master.resources) {
    var res = taskAssig.task.master.resources[i];
    var opt = $("<option>");
    opt.val(res.id).html(res.name);
    if (taskAssig.assig.resourceId == res.id)
      opt.attr("selected", "true");
    resEl.append(opt);
  }


  var roleEl = assigTr.find("[name=roleId]");
  for (var i in taskAssig.task.master.roles) {
    var role = taskAssig.task.master.roles[i];
    var optr = $("<option>");
    optr.val(role.id).html(role.name);
    if (taskAssig.assig.roleId == role.id)
      optr.attr("selected", "true");
    roleEl.append(optr);
  }

  if(taskAssig.task.master.canWrite && taskAssig.task.canWrite){
    assigTr.find(".delAssig").click(function() {
      var tr = $(this).closest("[assigId]").fadeOut(200, function() {
        $(this).remove();
      });
    });
  }
});
</script>
<div class="openShow">
    <dl>
        <dt>
            <div>
                <div class="li active">上色<br /><em>2018/1/15<br/>15:00</em><br/><i>|</i></div>
                <div class="li active">线条<br /><em>2018/1/15<br/>15:00</em><br/><i>|</i></div>
                <div class="li action">线条<br /><em>&nbsp;<br/>&nbsp;</em><br/><i>|</i></div>
                <div class="li">建模<br /><em>&nbsp;<br/>&nbsp;</em><br/><i>|</i></div>
                <div class="li">完成<br /><em>&nbsp;<br/>&nbsp;</em><br/><i>|</i></div>
                <div class="clear"></div>
            </div>
            <p><span style="width:20%">&nbsp;</span></p>
        </dt>
        <div>
            <dd class="cue">超时<br/><b>40h</b></dd>
            <dd>
                <ul>
                    <li>任务开始<br /><span>2018/1/12<br />15:00</span></li>
                    <li class="li-c">26工作日<br/><span>剩余60h</span></li>
                    <li class="li-r">预计结束<br /><span>2018/1/12<br />15:00</span></li>
                </ul>
            </dd>
            <div class="clear"></div>
        </div>
    </dl>
</div>

<select class="selectDate">
	<option value="getDay">天</option>
	<option value="getWeek">周</option>
	<option value="getMoon">月</option>
</select>

<div class="openDetails">
	<span>X</span>
</div>

<div class="addpeople">
    <input type="text" placeholder="参与人的姓名" class="peopleInt">
    <dl>
        <dt>
            <a href="#" class="show">全部成员</a>
            <a href="#">3D模型</a>
            <a href="#">地编组</a>
            <a href="#">次世代</a>
        </dt>
        <dd style="display:block">
            <label><input type="radio" value="张三" name="addpeop"/>张三</label>
            <label><input type="radio" value="张四" name="addpeop"/>张四</label>
            <label><input type="radio" value="张五" name="addpeop"/>张五</label>
            <label><input type="radio" value="张六" name="addpeop"/>张六</label>
            <label><input type="radio" value="张七" name="addpeop"/>张七</label>
        </dd>
        <dd>
            <label><input type="radio" value="张四" name="addpeop"/>张四</label>
            <label><input type="radio" value="张五" name="addpeop"/>张五</label>
        </dd>
        <dd>
            <label><input type="radio" value="张六" name="addpeop"/>张六</label>
        </dd>
        <dd>
            <label><input type="radio" value="张七" name="addpeop"/>张七</label>
        </dd>
        <div class="clear"></div>
    </dl>
</div>

</body>
</html>